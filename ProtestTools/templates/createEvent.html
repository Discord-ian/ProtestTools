<!DOCTYPE html>
<html>
 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
<head><h1>ProtestTools</h1>
    <style>
        #map_section {
            display:flex;
            height:100vh
        }
        #map {
            height: 40vh;
            justify-content: center;
            width: 40vw;
        }
    </style>


</head>
<body>
Location Map<br>
<div id="map">
    <script>
    var startLat = {{ lat|safe }}
    var startLong = {{ long|safe }}
    var map = L.map('map').setView([startLat, startLong], 13);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);
    var marker;
    var lat, lng;
    var form = document.querySelector("#event_form")

    function onMapClick(e) {
        if(marker == null) {
            marker = L.marker(e.latlng, {draggable:true}).addTo(map)
            document.querySelector("#event_form").addEventListener("submit", (event) => {
            event.preventDefault();
            sendFormData()
    });
        }
    }
    map.on('click', onMapClick)
    async function sendFormData() {
        console.log("data")
        const formData = new FormData(document.querySelector("#event_form"));
        if (marker != null) {
            lat = marker.getLatLng().lat;
            lng = marker.getLatLng().lng;
        }
        formData.append("lat", lat);
        formData.append("lng", lng);
        try {
            const response = await fetch("/map/create_event", {
                method: 'POST',
                body: formData
                })
            console.log(await response.json())
            }
            catch (e)
            {
            console.error(e);
            }
    }

</script>
</div>
<br>
<div class="inputbox">
    <form action=" ", method="post" id="event_form">
        <div class="col-25">
            <label for="evname">Event Name</label>
        </div>
        <div class="col-75">
            <input type="text" id="evname" name="event_name" placeholder="Event name..">
        </div>

        <div>
            <label for="evdesc">Event Description</label><br>
            <textarea id="evdesc" name="event_description" cols="50" rows="10"></textarea>
        </div>
        <div class="col-25">
            <label for="evcause">Cause</label>
        </div>
        <div class="col-75">
            <input type="text" id="evcause" name="event_cause">
        </div>
        <div class="col-25">
            <label for="evdate">Event Date</label>
        </div>
        <div class="col-75">
            <input type="date" id="evdate" name="event_date">
        </div>
        <div class="col-25">
            <label for="evtime">Event Start Time</label>
        </div>
        <div class="col-75">
            <input type="time" id="evtime" name="event_time">
        </div>
        <div class="col-25">
            <label for="evaddress">Street Address</label>
        </div>
        <div class="col-75">
            <input type="text" id="evaddress" name="event_address" placeholder="Street Address">
        </div>
        <div class="col-25">
            <label for="evcity">City</label>
        </div>
        <div class="col-75">
            <input type="text" id="evcity" name="event_city" placeholder="City..">
        </div>
        <div class="col-25">
            <label for="evzip">Zip Code</label>
        </div>
        <div class="col-75">
            <input type="text" id="evzip" name="event_zip">
        </div>
        <div class="col-25">
            <label for="evstate">State</label>
        </div>
        <div class="col-75">
            <input type="text" id="evstate" name="event_state" placeholder="State(two letter)..">
        </div>
        <input type="submit"/>
    </form>
</div>
</body>
</html>
